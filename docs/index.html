<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>template</title><meta name="description" content="Documentation for template"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">template</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1> template </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#práctica-11---cliente-y-servidor-para-una-aplicación-de-procesamiento-de-notas-de-texto" id="práctica-11---cliente-y-servidor-para-una-aplicación-de-procesamiento-de-notas-de-texto" style="color: inherit; text-decoration: none;">
  <h1>Práctica 11 - Cliente y servidor para una aplicación de procesamiento de notas de texto</h1>
</a>

<a href="#objetivos" id="objetivos" style="color: inherit; text-decoration: none;">
  <h2>Objetivos</h2>
</a>
<p>A partir de la aplicación de procesamiento de notas llevada a cabo en la Práctica 9, se propone el desarrollo de un servidor y un cliente haciendo uso de los sockets proporcionados por el módulo <code>net</code> de Node.js.</p>
<p>Todo el código desarrollado se encuentra bajo el directorio <code>src</code> del proyecto. Los tests implementados para los mismos se encuentran en <code>tests</code>.</p>
<p>Los requisitos de la aplicación son similares a los de la práctica anteriormente desarrollada, esto es, la aplicación permitirá añadir una nota, modificarla, eliminarla, listar las notas de un usuario y leer una nota concreta.</p>
<p>En este caso, será el servidor el encargado de hacer persistente la lista de notas de cada usuario. Así, todas las notas se almacenarán en un fichero JSON bajo el directorio del usuario correspondiente. Asimismo, será el servidor el encargado de cargar las notas de los diferentes ficheros, con el objetivo de procesar las peticiones del cliente y devolver las respuestas apropiadas.</p>
<p>El usuario interactirará con la aplicación a través de la línea de comandos del cliente, que será el encargado de enviar las peticiones al servidor. Los diferentes comandos se gestionarán mediante el paquete <code>yargs</code>.</p>
<p>De esta manera se muestra a continuación la implementación del código desarrollado.</p>

<a href="#implementación" id="implementación" style="color: inherit; text-decoration: none;">
  <h3>Implementación</h3>
</a>
<p>La aplicación de un servidor para el manejo de los ficheros y el procesamiento de las peticiones del cliente se ha llevado a cabo mediante la creación de una clase <code>receiverServer</code>. Además, el cliente permitirá enviar las peticiones con su correspondiente clase <code>requestClient</code>. Ambas clases emitirán eventos propios cuando se reciba la petición del cliente, y cuando el cliente reciba la respuesta del servidor.</p>
<p>El intercambio de mensajes entre el servidor y cliente se realiza mediante dos tipos de datos definidos en el fichero <code>messageTypes</code>, donde existe un tipo <code>RequestType</code> para el envío de peticiones del cliente, y <code>ResponseType</code> para las respuestas de servidor hacia el cliente.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">RequestType</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">user</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">title</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">body</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">color</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">chtitle</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">chbody</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">chcolor</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">type</span><span class="hl-1"> </span><span class="hl-3">ResponseType</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">success</span><span class="hl-1">: </span><span class="hl-3">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">description</span><span class="hl-1">?: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">notes</span><span class="hl-1">?: </span><span class="hl-3">Note</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Las <code>RequestType</code> indicarán el tipo de petición que es, el usuario a revisar sus notas, y parámetros opcionales como el título de la nota, cuerpo, color, y otros atributos que, en caso de definirse junto con el tipo <code>update</code>, permitirán modificar campos específicos de la nota.</p>
<p><code>ResponseType</code>, además de indicar el tipo de petición al que la respuesta se atribuye, tiene un campo <code>success</code> para indicar si la petición se ha llevado a cabo de manera correcta, además de un parámetro opcional <code>description</code> para que el servidor envíe una explicación si la operación no se ha llevado a cabo de manera correcta. El campo <code>notes</code> devolverá al cliente un grupo de notas en caso de que este último las haya solicitado.</p>
<p>Se procede así a la explicación del código del cliente y servidor.</p>

<a href="#implementación-del-servidor" id="implementación-del-servidor" style="color: inherit; text-decoration: none;">
  <h3>Implementación del Servidor</h3>
</a>
<p>Para la recepción de peticiones del servidor, como se comentó anteriormente, se ha implementado una clase <code>ReceiveServer</code>, que extiende de la clase <code>EventEmitter</code> con el objetivo de emitir un evento cada vez que se recibe dicha petición, para que el código del servidor pueda procesar la respuesta.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">ReceiverServer</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">EventEmitter</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">server</span><span class="hl-1">: </span><span class="hl-3">net</span><span class="hl-1">.</span><span class="hl-3">Server</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-4">port</span><span class="hl-1">: </span><span class="hl-3">number</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">super</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">server</span><span class="hl-1"> = </span><span class="hl-4">net</span><span class="hl-1">.</span><span class="hl-6">createServer</span><span class="hl-1">({</span><span class="hl-4">allowHalfOpen:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">}, (</span><span class="hl-4">connection</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Request received from client.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-7">// Stores the whole data.</span><br/><span class="hl-1">      </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">wholeRequest</span><span class="hl-1"> = </span><span class="hl-5">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-4">requestChunk</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">wholeRequest</span><span class="hl-1"> += </span><span class="hl-4">requestChunk</span><span class="hl-1">;</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-7">// When the client ends sending the request.</span><br/><span class="hl-1">      </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">request</span><span class="hl-1">: </span><span class="hl-3">RequestType</span><span class="hl-1"> = </span><span class="hl-3">JSON</span><span class="hl-1">.</span><span class="hl-6">parse</span><span class="hl-1">(</span><span class="hl-4">wholeRequest</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;request&#39;</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">, </span><span class="hl-4">connection</span><span class="hl-1">);</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }).</span><span class="hl-6">listen</span><span class="hl-1">(</span><span class="hl-4">port</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Waiting for clients to connect.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">sendResponse</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1">, </span><span class="hl-4">socket</span><span class="hl-1">: </span><span class="hl-3">net</span><span class="hl-1">.</span><span class="hl-3">Socket</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">write</span><span class="hl-1">(</span><span class="hl-3">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">end</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">closeServer</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-6">close</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>De esta manera, la clase implementa un atributo <code>server</code> donde se almacenará el objeto devuelto por <code>net.createServer</code>. Esto permitirá más adelante cerrar el servidor a través del método <code>closeServer</code>. En el constructor, el servidor se abre con la opción <code>{allowHalfOpen: true}</code> para que el servidor pueda responder al cliente aunque éste haya cerrado su lado del socket. De esta manera, el manejador de <code>createServer</code> se ejecutará cuando un cliente se conecte. Ante la recepción de una petición, se irá almacenando en la variable <code>wholeRequest</code>, hasta que el servidor envíe un evento de tipo <code>end</code>. Esto significará que se ha terminado de enviar la petición, y por lo tanto, la clase emitirá un evento <code>request</code>, que devolverá como parámetros la petición parseada y el socket de la conexión.</p>
<p>De esta manera el código del servidor, que se encuentra en el fichero <code>serverApp</code>, ejecutará las acciones correspondientes cuando el servidor emita un evento <code>request</code>.</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">notesDataBase</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">NotesFileSystem</span><span class="hl-1">();</span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">server</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">ReceiverServer</span><span class="hl-1">(</span><span class="hl-9">60200</span><span class="hl-1">);</span><br/><br/><span class="hl-7">// The server attends the clients`s petitions</span><br/><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;request&#39;</span><span class="hl-1">, (</span><span class="hl-4">request</span><span class="hl-1">, </span><span class="hl-4">socket</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">userNotes</span><span class="hl-1"> = </span><span class="hl-4">notesDataBase</span><span class="hl-1">.</span><span class="hl-6">getUserNotes</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1"> = {</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><br/><span class="hl-1">  </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-6">isColor</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1">)) {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">noteToAdd</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">Note</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">ColorChoice</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">notesDataBase</span><span class="hl-1">.</span><span class="hl-6">addNewNote</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">noteToAdd</span><span class="hl-1">) === -</span><span class="hl-9">1</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error, nota </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">title</span><span class="hl-2">}</span><span class="hl-5"> ya existente`</span><span class="hl-1">,</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">&#39;Nota añadida con éxito&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: el color </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">color</span><span class="hl-2">}</span><span class="hl-5"> no está disponible`</span><span class="hl-1">,</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">userNotes</span><span class="hl-1"> === </span><span class="hl-5">&#39;undefined&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: no se encuentra el usuario </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">note</span><span class="hl-1"> = </span><span class="hl-4">userNotes</span><span class="hl-1">.</span><span class="hl-6">getNote</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">note</span><span class="hl-1"> === </span><span class="hl-5">&#39;undefined&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: no existe nota </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">title</span><span class="hl-2">}</span><span class="hl-5"> del usuario </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">notesDataBase</span><span class="hl-1">.</span><span class="hl-6">deleteNote</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">chtitle</span><span class="hl-1"> !== </span><span class="hl-5">&#39;undefined&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-6">setTitle</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">chtitle</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">chbody</span><span class="hl-1"> !== </span><span class="hl-5">&#39;undefined&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-6">setBody</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">chbody</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> ((</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">chcolor</span><span class="hl-1"> !== </span><span class="hl-5">&#39;undefined&#39;</span><span class="hl-1">) &amp;&amp; (</span><span class="hl-6">isColor</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">chcolor</span><span class="hl-1">))) {</span><br/><span class="hl-1">            </span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-6">setColor</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">chcolor</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">ColorChoice</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">notesDataBase</span><span class="hl-1">.</span><span class="hl-6">addNewNote</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">note</span><span class="hl-1">) === </span><span class="hl-9">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">              </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Nota modificada con éxito`</span><span class="hl-1">,</span><br/><span class="hl-1">            };</span><br/><span class="hl-1">          } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">              </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;update&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">              </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: error inesperado`</span><span class="hl-1">,</span><br/><span class="hl-1">            };</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">notesDataBase</span><span class="hl-1">.</span><span class="hl-6">deleteNote</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">, </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">) === -</span><span class="hl-9">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: no existe ninguna nota con título </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">title</span><span class="hl-2">}</span><span class="hl-5"> del usuario </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;remove&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Nota </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">title</span><span class="hl-2">}</span><span class="hl-5"> eliminada con éxito`</span><span class="hl-1">,</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">userNotes</span><span class="hl-1"> === </span><span class="hl-5">&#39;undefined&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: no se encuentra el usuario </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">note</span><span class="hl-1"> = </span><span class="hl-4">userNotes</span><span class="hl-1">.</span><span class="hl-6">getNote</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">note</span><span class="hl-1"> === </span><span class="hl-5">&#39;undefined&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: no existe nota </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">title</span><span class="hl-2">}</span><span class="hl-5"> del usuario </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">        } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">notes:</span><span class="hl-1"> [</span><span class="hl-4">note</span><span class="hl-1">],</span><br/><span class="hl-1">          };</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">userNotes</span><span class="hl-1"> !== </span><span class="hl-5">&quot;undefined&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">notes:</span><span class="hl-1"> </span><span class="hl-4">userNotes</span><span class="hl-1">.</span><span class="hl-6">getUserNotes</span><span class="hl-1">(),</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">      } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">response</span><span class="hl-1"> = {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-2">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-5">`Error: no se encuentra el usuario </span><span class="hl-2">${</span><span class="hl-4">request</span><span class="hl-10">.</span><span class="hl-4">user</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">,</span><br/><span class="hl-1">        };</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-7">// The server sends the response to the client</span><br/><span class="hl-1">  </span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-6">sendResponse</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">, </span><span class="hl-4">socket</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Así, el manejador del evento <code>request</code> procesará la petición recibida, obteniendo las notas del usuario correspondiente, y rellenando, en cada opción, la respuesta adecuada. Por ejemplo, en el caso de la petición sea de tipo <code>add</code>, creará una nueva nota y la añadirá mediante el método <code>addNewNote</code> de la clase <code>NotesFileSystem</code> implementada en la práctica anterior. Si la acción se realiza exitosamente, la respuesta tendrá el atributo <code>success</code> a <code>true</code> y enviará una descripción con los resultados de la operación. En caso de fallo, por ejemplo, porque ya existe una nota con el mismo nombre, el campo <code>success</code> se pondrá a <code>false</code> y la descripción describirá este hecho.</p>
<p>De manera similar, en otros tipos de petición, los campos de la respuesta se rellenarán de manera correspondiente. En los casos de los tipos <code>read</code> y <code>list</code>, la respuesta contendrá en el campo de <code>notes</code> las notas que el cliente habrá solicitado.</p>
<p>Por último, el código del servidor envía la respuesta mediante el método <code>sendResponse</code> de la clase <code>ReceiverServer</code>, la cual enviará la respuesta y cerrará el socket de la conexión.</p>

<a href="#implementación-del-cliente" id="implementación-del-cliente" style="color: inherit; text-decoration: none;">
  <h3>Implementación del Cliente</h3>
</a>
<p>Para realizar las peticiones al servidor, una clase <code>RequestClient</code> permitirá realizar una conexión al servidor al servidor y emitir eventos <code>response</code> cuando le el servidor envíe la respuesta.</p>
<pre><code class="language-ts"><span class="hl-7">/**</span><br/><span class="hl-7"> * Class that emits an event when a server replies to the request.</span><br/><span class="hl-7"> * Defines methods to request a petition to the server.</span><br/><span class="hl-7"> */</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">class</span><span class="hl-1"> </span><span class="hl-3">RequestClient</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">EventEmitter</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">constructor</span><span class="hl-1">(</span><span class="hl-2">private</span><span class="hl-1"> </span><span class="hl-4">connection</span><span class="hl-1">: </span><span class="hl-3">net</span><span class="hl-1">.</span><span class="hl-3">Socket</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">super</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-7">// Stores the whole data send by the server.</span><br/><span class="hl-1">    </span><span class="hl-2">let</span><span class="hl-1"> </span><span class="hl-4">wholeResponse</span><span class="hl-1"> = </span><span class="hl-5">&#39;&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;data&#39;</span><span class="hl-1">, (</span><span class="hl-4">responseChunk</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">wholeResponse</span><span class="hl-1"> += </span><span class="hl-4">responseChunk</span><span class="hl-1">;</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-7">// When the server ends sending the reply.</span><br/><span class="hl-1">    </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;end&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">response</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1"> = </span><span class="hl-3">JSON</span><span class="hl-1">.</span><span class="hl-6">parse</span><span class="hl-1">(</span><span class="hl-4">wholeResponse</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;response&#39;</span><span class="hl-1">, </span><span class="hl-4">response</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-2">public</span><span class="hl-1"> </span><span class="hl-6">makeRequest</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">: </span><span class="hl-3">RequestType</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-6">write</span><span class="hl-1">(</span><span class="hl-3">JSON</span><span class="hl-1">.</span><span class="hl-6">stringify</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-2">this</span><span class="hl-1">.</span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-6">end</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>De esta manera, un objeto de la clase <code>RequestClient</code> se conectará al puerto que se le proporcione como parámetro en el constructor, e instanciará un manejador para la recepción de respuestas del servidor, que irá almacenando el mensaje en <code>wholeResponse</code>. Cuando reciba un evento <code>end</code>, el servidor habrá terminado de mandar su respuesta y, en consecuencia, el cliente parseará la respuesta y emitirá un evento <code>response</code>, para que el programa del cliente se encargue de procesar la misma.</p>
<p>Mediante el uso del método <code>makeRequest</code> de esta clase, se podrán realizar peticiones al servidor, cerrando el socket una vez se envíe la misma.</p>
<p>Así, el programa cliente, alojado en el fichero <code>noteApp.ts</code> es el siguiente:</p>
<pre><code class="language-ts"><span class="hl-7">// The clients allows to make petitions to the server</span><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">client</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">RequestClient</span><span class="hl-1">(</span><span class="hl-6">connect</span><span class="hl-1">({</span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-9">60200</span><span class="hl-1">}));</span><br/><br/><span class="hl-7">// Manager when the server responds to a request</span><br/><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;response&#39;</span><span class="hl-1">, (</span><span class="hl-4">serverResponse</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">response</span><span class="hl-1">: </span><span class="hl-3">ResponseType</span><span class="hl-1"> = </span><span class="hl-4">serverResponse</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">success</span><span class="hl-1"> === </span><span class="hl-2">false</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">red</span><span class="hl-1">.</span><span class="hl-6">inverse</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">description</span><span class="hl-1">));</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;list&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">notesToList</span><span class="hl-1"> = </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">notes</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">unknown</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">NoteInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">        </span><span class="hl-4">notesToList</span><span class="hl-1">.</span><span class="hl-6">forEach</span><span class="hl-1">((</span><span class="hl-4">note</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">color</span><span class="hl-1"> = </span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1">;</span><br/><span class="hl-1">          </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">color</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;blue&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">blue</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;red&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">red</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;yellow&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">yellow</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;green&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">green</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><br/><span class="hl-1">      </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;read&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">notesToRead</span><span class="hl-1"> = </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">notes</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">unknown</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">NoteInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">        </span><span class="hl-4">notesToRead</span><span class="hl-1">.</span><span class="hl-6">forEach</span><span class="hl-1">((</span><span class="hl-4">note</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">switch</span><span class="hl-1"> (</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;blue&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">blue</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">blue</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;red&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">red</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">red</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;yellow&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">yellow</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">yellow</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">            </span><span class="hl-0">case</span><span class="hl-1"> </span><span class="hl-5">&#39;green&#39;</span><span class="hl-1">:</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">green</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-6">green</span><span class="hl-1">(</span><span class="hl-4">note</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">));</span><br/><span class="hl-1">              </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">        </span><span class="hl-0">break</span><span class="hl-1">;</span><br/><br/><span class="hl-1">      </span><span class="hl-0">default</span><span class="hl-1">:</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-4">chalk</span><span class="hl-1">.</span><span class="hl-4">green</span><span class="hl-1">.</span><span class="hl-6">inverse</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">description</span><span class="hl-1">));</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>De esta manera, se instancia un objeto cliente de la clase <code>RequestClient</code>. Con ello, cuando se emita un evento de tipo <code>response</code>, el programa analizará la respuesta del servidor. En primer lugar, se analizará el atributo <code>success</code> de la respuesta para determinar si la acción se ha llevado a cabo correctamente, imprimiendo por consola la descripción proporcionada por el servidor en caso contrario. </p>
<p>Una vez asegurada que la petición se ha procesado correctamente, se analiza su tipo. Si es de tipo <code>list</code>, se imprime por pantalla los títulos de las notas devueltos por el servidor en el parámetro <code>notes</code>, con el color de la nota que corresponda. De manera similar para el tipo <code>read</code>, la nota devuelta se imprimirá del color indicado en la misma. Un apunte importante es la conversión de tipo realizada en la siguiente línea:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">notesToRead</span><span class="hl-1"> = </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-4">notes</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">unknown</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">NoteInterface</span><span class="hl-1">[];</span>
</code></pre>
<p>Uno de los problemas encontrados al intentar acceder al atributo de las notas, es que no se podían acceder a los métodos getters de la clase <code>Note</code> cuando se obtenían las mismas con <code>JSON.parse()</code>. Su uso resultaba en un error en tiempo de ejecución, donde se indicaba que los métodos no existían. Por ello, se ha llevado a cabo la creación de una interfaz de notas, donde se especifican los atributos de <code>title</code>, <code>body</code> y <code>color</code>:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">NoteInterface</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">title</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">body</span><span class="hl-1">: </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">color</span><span class="hl-1">: </span><span class="hl-3">ColorChoice</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>De esta manera, como el objeto devuelto por response.notes es de tipo <code>Note</code>, primero se realiza su conversión a <code>unknown</code>, para seguidamente pasar a tipo <code>NoteInterface</code> y así, poder acceder de manera directa a sus atributos.</p>
<p>Por último, para el resto de tipos de respuesta, en los casos de <code>add</code>, <code>update</code> y <code>remove</code>, simplemente se imprimirá el mensaje informativo del servidor en el parámetro <code>description</code> en color verde.</p>
<p>Para el procesamiento de los parámetros por línea de comandos, como se comentó anteriormente, se realiza mediante el paquete <code>yargs</code>. Al igual que la práctica 9, 
se definirán manejadores para cada tipo de petición correspondiente, que requerirá de sus parámetros correspondientes.</p>
<pre><code class="language-ts"><span class="hl-7">// Add command to add a new user`s note</span><br/><span class="hl-4">yargs</span><span class="hl-1">.</span><span class="hl-6">command</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">command:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">describe:</span><span class="hl-1"> </span><span class="hl-5">&#39;Add a new note&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">builder:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">user:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">describe:</span><span class="hl-1"> </span><span class="hl-5">&#39;Name of the user&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">demandOption:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">describe:</span><span class="hl-1"> </span><span class="hl-5">&#39;Note title&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">demandOption:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">body:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">describe:</span><span class="hl-1"> </span><span class="hl-5">&#39;Note body&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">demandOption:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">color:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">describe:</span><span class="hl-1"> </span><span class="hl-5">&#39;Note color&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">demandOption:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">handler</span><span class="hl-1">(</span><span class="hl-4">argv</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> ((</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1"> === </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1">) &amp;&amp; (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1"> === </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1">) &amp;&amp;</span><br/><span class="hl-1">        (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1"> === </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1"> &amp;&amp; (</span><span class="hl-2">typeof</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1"> === </span><span class="hl-5">&#39;string&#39;</span><span class="hl-1">))) {</span><br/><span class="hl-1">      </span><span class="hl-7">// Petition to server</span><br/><span class="hl-1">      </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-6">makeRequest</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">user:</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">title</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">body:</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">color:</span><span class="hl-1"> </span><span class="hl-4">argv</span><span class="hl-1">.</span><span class="hl-4">color</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Un ejemplo del mismo es la petición de tipo <code>add</code>, donde el usuario deberá proporcionar los parámetros de <code>user</code>, <code>title</code>, <code>body</code> y <code>color</code>. Una vez proporcionados, el manejador simplemente deberá realizar la petición al cliente mediante el método <code>makeRequest</code> con los atributos correspondientes, dejando al servidor con la responsabilidad de procesar los mismos e informar si son correctos. En este caso, el servidor podría hacer que, en caso de que ya hubiera una nota del usuario con el mismo título, informara de la incidencia en la respuesta.</p>
<p>De esta manera se realizaría la interacción entre el programa cliente y servidor. Un ejemplo de la ejecución de ambos sería el siguiente:</p>
<p><img src="./img/ejecucion_programa.JPG" alt="Ejecución del programa cliente y servidor"></p>

<a href="#pruebas" id="pruebas" style="color: inherit; text-decoration: none;">
  <h3>Pruebas</h3>
</a>
<p>Se han implementado algunas pruebas para el código del cliente y servidor. En especial, se han puesto en funcionamiento las emisiones de eventos tipo <code>request</code> de la clase <code>ReceiverServer</code> y de tipo <code>response</code> de la clase <code>RequestClient</code>. De esta manera, se podrá asegurar el correcto funcionamiento de las mismas, observando como ante la recepción de una petición por parte del cliente, éste emite el correspondiente evento:</p>
<pre><code class="language-ts"><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-5">&#39;ReceiverServer&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should emit a response event once it gets a complete request&#39;</span><span class="hl-1">, (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">server</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">ReceiverServer</span><span class="hl-1">(</span><span class="hl-9">60100</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">client</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">RequestClient</span><span class="hl-1">(</span><span class="hl-4">net</span><span class="hl-1">.</span><span class="hl-6">connect</span><span class="hl-1">({</span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-9">60100</span><span class="hl-1">}));</span><br/><br/><span class="hl-1">    </span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;request&#39;</span><span class="hl-1">, (</span><span class="hl-4">request</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-6">closeServer</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-4">request</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-4">be</span><span class="hl-1">.</span><span class="hl-6">eql</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;type&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;add&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;user&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;john&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;title&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;aTitle&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;body&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;aBody&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-5">&quot;color&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;blue&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">      </span><span class="hl-6">done</span><span class="hl-1">();</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-6">makeRequest</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-5">&#39;add&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">user:</span><span class="hl-1"> </span><span class="hl-5">&#39;john&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-5">&#39;aTitle&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">body:</span><span class="hl-1"> </span><span class="hl-5">&#39;aBody&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">color:</span><span class="hl-1"> </span><span class="hl-5">&#39;blue&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Y de la misma manera, cuando el cliente reciba una respuesta del servidor, éste emitirá el evento <code>response</code> junto a sus datos:</p>
<pre><code class="language-ts"><span class="hl-6">describe</span><span class="hl-1">(</span><span class="hl-5">&#39;RequestClient&#39;</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">it</span><span class="hl-1">(</span><span class="hl-5">&#39;Should emit a response event once it gets a complete message&#39;</span><span class="hl-1">, (</span><span class="hl-4">done</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">socket</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-4">net</span><span class="hl-1">.</span><span class="hl-6">Socket</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-8">client</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-6">RequestClient</span><span class="hl-1">(</span><span class="hl-4">socket</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-6">on</span><span class="hl-1">(</span><span class="hl-5">&#39;response&#39;</span><span class="hl-1">, (</span><span class="hl-4">response</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">expect</span><span class="hl-1">(</span><span class="hl-4">response</span><span class="hl-1">).</span><span class="hl-4">to</span><span class="hl-1">.</span><span class="hl-4">be</span><span class="hl-1">.</span><span class="hl-6">eql</span><span class="hl-1">({</span><span class="hl-5">&quot;type&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">&quot;add&quot;</span><span class="hl-1">, </span><span class="hl-5">&quot;success&quot;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-6">done</span><span class="hl-1">();</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;data&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;{&quot;type&quot;: &quot;add&quot;&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;data&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;, &quot;success&quot;: true}&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">socket</span><span class="hl-1">.</span><span class="hl-6">emit</span><span class="hl-1">(</span><span class="hl-5">&#39;end&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code></pre>
<p>La ejecución de las pruebas permitirá observar su correcta implementación:</p>
<p><img src="./img/pruebas_cliente_servidor.JPG" alt="Pruebas cliente y servidor"></p>

<a href="#conclusión" id="conclusión" style="color: inherit; text-decoration: none;">
  <h3>Conclusión</h3>
</a>
<p>De esta manera, se ha llevado a cabo la implementación de un programa cliente, que permite realizar las peticiones a un servidor, cuyo programa permitirá recibir las mismas, gestionar el procesamiento de las notas, y enviar una respuesta al cliente.</p>
<p>Se ha puesto en práctica el conocimiento sobre la clase <code>EventEmitter</code>, para que las clases puedieran emitir sus propios eventos, así como del módulo <code>net</code> de <code>fs</code> para el manejo de las conexiones entre un servidor local y un cliente, mediante el uso de objetos <code>Server</code> y <code>Socket</code>. Con ello, se han implementado los manejadores correspondientes para el manejo de los eventos de la conexión en el socket, puediendo desarrollar así la aplicación cliente-servidor.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Modules</a></li><li class=" tsd-kind-module"><a href="modules/messageTypes.html">message<wbr/>Types</a></li><li class=" tsd-kind-module"><a href="modules/note.html">note</a></li><li class=" tsd-kind-module"><a href="modules/notesFileSystem.html">notes<wbr/>File<wbr/>System</a></li><li class=" tsd-kind-module"><a href="modules/receiverServer.html">receiver<wbr/>Server</a></li><li class=" tsd-kind-module"><a href="modules/requestClient.html">request<wbr/>Client</a></li><li class=" tsd-kind-module"><a href="modules/userNotes.html">user<wbr/>Notes</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>